"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{1853:function(e,t,n){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=r.useState,o=r.useEffect,l=r.useLayoutEffect,s=r.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!a(e,n)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=i({inst:{value:n,getSnapshot:t}}),a=r[0].inst,c=r[1];return l(function(){a.value=n,a.getSnapshot=t,u(a)&&c({inst:a})},[e,n,t]),o(function(){return u(a)&&c({inst:a}),e(function(){u(a)&&c({inst:a})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:c},6272:function(e,t,n){e.exports=n(1853)},8050:function(e,t,n){n.d(t,{RJ:function(){return em}});var r,a=n(2265),i=n(6272);let o=()=>{},l=o(),s=Object,u=e=>e===l,c=e=>"function"==typeof e,d=(e,t)=>({...e,...t}),f=e=>c(e.then),p=new WeakMap,g=0,y=e=>{let t,n;let r=typeof e,a=e&&e.constructor,i=a==Date;if(s(e)!==e||i||a==RegExp)t=i?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=p.get(e))return t;if(t=++g+"~",p.set(e,t),a==Array){for(n=0,t="@";n<e.length;n++)t+=y(e[n])+",";p.set(e,t)}if(a==s){t="#";let r=s.keys(e).sort();for(;!u(n=r.pop());)u(e[n])||(t+=n+":"+y(e[n])+",");p.set(e,t)}}return t},h=new WeakMap,m={},w={},v="undefined",_=typeof window!=v,E=typeof document!=v,b=()=>_&&typeof window.requestAnimationFrame!=v,R=(e,t)=>{let n=h.get(e);return[()=>!u(t)&&e.get(t)||m,r=>{if(!u(t)){let a=e.get(t);t in w||(w[t]=a),n[5](t,d(a,r),a||m)}},n[6],()=>!u(t)&&t in w?w[t]:!u(t)&&e.get(t)||m]},x=!0,[S,T]=_&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[o,o],k={initFocus:e=>(E&&document.addEventListener("visibilitychange",e),S("focus",e),()=>{E&&document.removeEventListener("visibilitychange",e),T("focus",e)}),initReconnect:e=>{let t=()=>{x=!0,e()},n=()=>{x=!1};return S("online",t),S("offline",n),()=>{T("online",t),T("offline",n)}}},O=!a.useId,C=!_||"Deno"in window,V=e=>b()?window.requestAnimationFrame(e):setTimeout(e,1),D=C?a.useEffect:a.useLayoutEffect,A="undefined"!=typeof navigator&&navigator.connection,I=!C&&A&&(["slow-2g","2g"].includes(A.effectiveType)||A.saveData),L=e=>{if(c(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?y(e):"",t]},N=0,j=()=>++N;var F={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function M(...e){let[t,n,r,a]=e,i=d({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{}),o=i.populateCache,s=i.rollbackOnError,p=i.optimisticData,g=!1!==i.revalidate,y=e=>"function"==typeof s?s(e):!1!==s,m=i.throwOnError;if(c(n)){let e=[];for(let r of t.keys())!/^\$(inf|sub)\$/.test(r)&&n(t.get(r)._k)&&e.push(r);return Promise.all(e.map(w))}return w(n);async function w(n){let a;let[i]=L(n);if(!i)return;let[s,d]=R(t,i),[w,v,_,E]=h.get(t),b=w[i],x=()=>g&&(delete _[i],delete E[i],b&&b[0])?b[0](2).then(()=>s().data):s().data;if(e.length<3)return x();let S=r,T=j();v[i]=[T,0];let k=!u(p),O=s(),C=O.data,V=O._c,D=u(V)?C:V;if(k&&d({data:p=c(p)?p(D,C):p,_c:D}),c(S))try{S=S(D)}catch(e){a=e}if(S&&f(S)){if(S=await S.catch(e=>{a=e}),T!==v[i][0]){if(a)throw a;return S}a&&k&&y(a)&&(o=!0,d({data:S=D,_c:l}))}o&&!a&&(c(o)&&(S=o(S,D)),d({data:S,error:l,_c:l})),v[i][1]=j();let A=await x();if(d({_c:l}),a){if(m)throw a;return}return o?A:S}}let P=(e,t)=>{for(let n in e)e[n][0]&&e[n][0](t)},U=(e,t)=>{if(!h.has(e)){let n=d(k,t),r={},a=M.bind(l,e),i=o,s={},u=(e,t)=>{let n=s[e]||[];return s[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},c=(t,n,r)=>{e.set(t,n);let a=s[t];if(a)for(let e of a)e(n,r)},f=()=>{if(!h.has(e)&&(h.set(e,[r,{},{},{},a,c,u]),!C)){let t=n.initFocus(setTimeout.bind(l,P.bind(l,r,0))),a=n.initReconnect(setTimeout.bind(l,P.bind(l,r,1)));i=()=>{t&&t(),a&&a(),h.delete(e)}}};return f(),[e,a,f,i]}return[e,h.get(e)[4]]},[W,J]=U(new Map),q=d({onLoadingSlow:o,onSuccess:o,onError:o,onErrorRetry:(e,t,n,r,a)=>{let i=n.errorRetryCount,o=a.retryCount,l=~~((Math.random()+.5)*(1<<(o<8?o:8)))*n.errorRetryInterval;(u(i)||!(o>i))&&setTimeout(r,l,a)},onDiscarded:o,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:I?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:I?5e3:3e3,compare:(e,t)=>y(e)==y(t),isPaused:()=>!1,cache:W,mutate:J,fallback:{}},{isOnline:()=>x,isVisible:()=>{let e=E&&document.visibilityState;return u(e)||"hidden"!==e}}),B=(e,t)=>{let n=d(e,t);if(t){let{use:r,fallback:a}=e,{use:i,fallback:o}=t;r&&i&&(n.use=r.concat(i)),a&&o&&(n.fallback=d(a,o))}return n},$=(0,a.createContext)({}),X=_&&window.__SWR_DEVTOOLS_USE__,z=X?window.__SWR_DEVTOOLS_USE__:[],G=e=>c(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],H=()=>d(q,(0,a.useContext)($)),K=z.concat(e=>(t,n,r)=>{let a=n&&((...e)=>{let[r]=L(t),[,,,a]=h.get(W),i=a[r];return u(i)?n(...e):(delete a[r],i)});return e(t,a,r)}),Q=(e,t,n)=>{let r=t[e]||(t[e]=[]);return r.push(n),()=>{let e=r.indexOf(n);e>=0&&(r[e]=r[r.length-1],r.pop())}};X&&(window.__SWR_DEVTOOLS_REACT__=a);let Y=a.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),Z={dedupe:!0};s.defineProperty(e=>{let{value:t}=e,n=(0,a.useContext)($),r=c(t),i=(0,a.useMemo)(()=>r?t(n):t,[r,n,t]),o=(0,a.useMemo)(()=>r?i:B(n,i),[r,n,i]),s=i&&i.provider,u=(0,a.useRef)(l);s&&!u.current&&(u.current=U(s(o.cache||W),i));let f=u.current;return f&&(o.cache=f[0],o.mutate=f[1]),D(()=>{if(f)return f[2]&&f[2](),f[3]},[]),(0,a.createElement)($.Provider,d(e,{value:o}))},"defaultValue",{value:q});let ee=(r=(e,t,n)=>{let{cache:r,compare:o,suspense:s,fallbackData:f,revalidateOnMount:p,revalidateIfStale:g,refreshInterval:y,refreshWhenHidden:m,refreshWhenOffline:w,keepPreviousData:v}=n,[_,E,b,x]=h.get(r),[S,T]=L(e),k=(0,a.useRef)(!1),A=(0,a.useRef)(!1),I=(0,a.useRef)(S),N=(0,a.useRef)(t),P=(0,a.useRef)(n),U=()=>P.current,W=()=>U().isVisible()&&U().isOnline(),[J,q,B,$]=R(r,S),X=(0,a.useRef)({}).current,z=u(f)?n.fallback[S]:f,G=(e,t)=>{for(let n in X)if("data"===n){if(!o(e[n],t[n])&&(!u(e[n])||!o(eo,t[n])))return!1}else if(t[n]!==e[n])return!1;return!0},H=(0,a.useMemo)(()=>{let e=!!S&&!!t&&(u(p)?!U().isPaused()&&!s&&(!!u(g)||g):p),n=t=>{let n=d(t);return(delete n._k,e)?{isValidating:!0,isLoading:!0,...n}:n},r=J(),a=$(),i=n(r),o=r===a?i:n(a),l=i;return[()=>{let e=n(J());return G(e,l)?(l.data=e.data,l.isLoading=e.isLoading,l.isValidating=e.isValidating,l.error=e.error,l):(l=e,e)},()=>o]},[r,S]),K=(0,i.useSyncExternalStore)((0,a.useCallback)(e=>B(S,(t,n)=>{G(n,t)||e()}),[r,S]),H[0],H[1]),ee=!k.current,et=_[S]&&_[S].length>0,en=K.data,er=u(en)?z:en,ea=K.error,ei=(0,a.useRef)(er),eo=v?u(en)?ei.current:en:er,el=(!et||!!u(ea))&&(ee&&!u(p)?p:!U().isPaused()&&(s?!u(er)&&g:u(er)||g)),es=!!(S&&t&&ee&&el),eu=u(K.isValidating)?es:K.isValidating,ec=u(K.isLoading)?es:K.isLoading,ed=(0,a.useCallback)(async e=>{let t,r;let a=N.current;if(!S||!a||A.current||U().isPaused())return!1;let i=!0,s=e||{},d=!b[S]||!s.dedupe,f=()=>O?!A.current&&S===I.current&&k.current:S===I.current,p={isValidating:!1,isLoading:!1},g=()=>{q(p)},y=()=>{let e=b[S];e&&e[1]===r&&delete b[S]},h={isValidating:!0};u(J().data)&&(h.isLoading=!0);try{if(d&&(q(h),n.loadingTimeout&&u(J().data)&&setTimeout(()=>{i&&f()&&U().onLoadingSlow(S,n)},n.loadingTimeout),b[S]=[a(T),j()]),[t,r]=b[S],t=await t,d&&setTimeout(y,n.dedupingInterval),!b[S]||b[S][1]!==r)return d&&f()&&U().onDiscarded(S),!1;p.error=l;let e=E[S];if(!u(e)&&(r<=e[0]||r<=e[1]||0===e[1]))return g(),d&&f()&&U().onDiscarded(S),!1;let s=J().data;p.data=o(s,t)?s:t,d&&f()&&U().onSuccess(t,S,n)}catch(n){y();let e=U(),{shouldRetryOnError:t}=e;!e.isPaused()&&(p.error=n,d&&f()&&(e.onError(n,S,e),(!0===t||c(t)&&t(n))&&W()&&e.onErrorRetry(n,S,e,e=>{let t=_[S];t&&t[0]&&t[0](F.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return i=!1,g(),!0},[S,r]),ef=(0,a.useCallback)((...e)=>M(r,I.current,...e),[]);if(D(()=>{N.current=t,P.current=n,u(en)||(ei.current=en)}),D(()=>{if(!S)return;let e=ed.bind(l,Z),t=0,n=Q(S,_,(n,r={})=>{if(n==F.FOCUS_EVENT){let n=Date.now();U().revalidateOnFocus&&n>t&&W()&&(t=n+U().focusThrottleInterval,e())}else if(n==F.RECONNECT_EVENT)U().revalidateOnReconnect&&W()&&e();else if(n==F.MUTATE_EVENT)return ed();else if(n==F.ERROR_REVALIDATE_EVENT)return ed(r)});return A.current=!1,I.current=S,k.current=!0,q({_k:T}),el&&(u(er)||C?e():V(e)),()=>{A.current=!0,n()}},[S]),D(()=>{let e;function t(){let t=c(y)?y(J().data):y;t&&-1!==e&&(e=setTimeout(n,t))}function n(){!J().error&&(m||U().isVisible())&&(w||U().isOnline())?ed(Z).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[y,m,w,S]),(0,a.useDebugValue)(eo),s&&u(er)&&S){if(!O&&C)throw Error("Fallback data is required when using suspense in SSR.");N.current=t,P.current=n,A.current=!1;let e=x[S];if(u(e)||Y(ef(e)),u(ea)){let e=ed(Z);u(eo)||(e.status="fulfilled",e.value=!0),Y(e)}else throw ea}return{mutate:ef,get data(){return X.data=!0,eo},get error(){return X.error=!0,ea},get isValidating(){return X.isValidating=!0,eu},get isLoading(){return X.isLoading=!0,ec}}},function(...e){let t=H(),[n,a,i]=G(e),o=B(t,i),l=r,{use:s}=o,u=(s||[]).concat(K);for(let e=u.length;e--;)l=u[e](l);return l(n,a||o.fetcher||null,o)});var et={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},en={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},er={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},ea={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},ei={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},eo={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},el={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},es={[et.code]:et,[en.code]:en,[er.code]:er,[ea.code]:ea,[ei.code]:ei,[eo.code]:eo,[el.code]:el};et.name,et.code,en.name,en.code,er.name,er.code,ea.name,ea.code,ei.name,ei.code,eo.name,eo.code,el.name,el.code;var eu=[et,en,er,ea,ei,eo,el].map(e=>e.code),ec=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let n=e.slice(0,t);if(!eu.includes(n))throw Error(`Failed to parse stream string. Invalid code ${n}.`);let r=JSON.parse(e.slice(t+1));return es[n].parse(r)};async function*ed(e,{isAborted:t}={}){let n=new TextDecoder,r=[],a=0;for(;;){let{value:i}=await e.read();if(i&&(r.push(i),a+=i.length,10!==i[i.length-1]))continue;if(0===r.length)break;let o=function(e,t){let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return e.length=0,n}(r,a);for(let e of(a=0,n.decode(o,{stream:!0}).split("\n").filter(e=>""!==e).map(ec)))yield e;if(null==t?void 0:t()){e.cancel();break}}}var ef=((e,t=21)=>(n=t)=>{let r="",a=n;for(;a--;)r+=e[Math.random()*e.length|0];return r})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);async function ep({reader:e,abortControllerRef:t,update:n,onFinish:r,generateId:a=ef,getCurrentDate:i=()=>new Date}){let o=i(),l={data:[]};for await(let{type:r,value:i}of ed(e,{isAborted:()=>(null==t?void 0:t.current)===null})){"text"===r&&(l.text?l.text={...l.text,content:(l.text.content||"")+i}:l.text={id:a(),role:"assistant",content:i,createdAt:o});let e=null;"function_call"===r&&(l.function_call={id:a(),role:"assistant",content:"",function_call:i.function_call,name:i.function_call.name,createdAt:o},e=l.function_call),"data"===r&&l.data.push(...i),n([e,l.text].filter(Boolean),[...l.data])}return null==r||r(l),{messages:[l.text,l.function_call].filter(Boolean),data:l.data}}async function eg({api:e,messages:t,body:n,credentials:r,headers:a,abortController:i,appendMessage:o,restoreMessagesOnFailure:l,onResponse:s,onUpdate:u,onFinish:c,generateId:d}){var f;let p=await fetch(e,{method:"POST",body:JSON.stringify({messages:t,...n}),headers:{"Content-Type":"application/json",...a},signal:null==(f=null==i?void 0:i())?void 0:f.signal,credentials:r}).catch(e=>{throw l(),e});if(s)try{await s(p)}catch(e){throw e}if(!p.ok)throw l(),Error(await p.text()||"Failed to fetch the chat response.");if(!p.body)throw Error("The response body is empty.");let g=p.body.getReader();if("true"===p.headers.get("X-Experimental-Stream-Data"))return await ep({reader:g,abortControllerRef:null!=i?{current:i()}:void 0,update:u,onFinish(e){c&&null!=e.text&&c(e.text)},generateId:d});{let e=new Date,t=function(e){let t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(ec).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}(!1),n="",r={id:d(),createdAt:e,content:"",role:"assistant"};for(;;){let{done:e,value:a}=await g.read();if(e)break;if((n+=t(a)).startsWith('{"function_call":')?r.function_call=n:r.content=n,o({...r}),(null==i?void 0:i())===null){g.cancel();break}}if(n.startsWith('{"function_call":')){let e=JSON.parse(n).function_call;r.function_call=e,o({...r})}return c&&c(r),r}}async function ey({getStreamedResponse:e,experimental_onFunctionCall:t,updateChatRequest:n,getCurrentMessages:r}){for(;;){let a=await e();if("messages"in a){let e=!1;for(let i of a.messages)if(void 0!==i.function_call&&"string"!=typeof i.function_call&&(e=!0,t)){let a=i.function_call,o=await t(r(),a);if(void 0===o){e=!1;break}n(o)}if(!e)break}else{if(void 0===a.function_call||"string"==typeof a.function_call)break;if(t){let e=a.function_call,i=await t(r(),e);if(void 0===i)break;n(i)}}}}var eh=async(e,t,n,r,a,i,o,l,s,u,c,d)=>{var f,p;let g=o.current;n(t.messages,!1);let y=d?t.messages:t.messages.map(({role:e,content:t,name:n,function_call:r})=>({role:e,content:t,...void 0!==n&&{name:n},...void 0!==r&&{function_call:r}}));if("string"!=typeof e){let r={id:s(),createdAt:new Date,content:"",role:"assistant"};async function h(e){let{content:a,ui:i,next:o}=await e;r.content=a,r.ui=await i,n([...t.messages,{...r}],!1),o&&await h(o)}try{let n=e({messages:y,data:t.data});await h(n)}catch(e){throw n(g,!1),e}return u&&u(r),r}return await eg({api:e,messages:y,body:{data:t.data,...i.current.body,...null==(f=t.options)?void 0:f.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call}},credentials:i.current.credentials,headers:{...i.current.headers,...null==(p=t.options)?void 0:p.headers},abortController:()=>l.current,appendMessage(e){n([...t.messages,e],!1)},restoreMessagesOnFailure(){n(g,!1)},onResponse:c,onUpdate(e,i){n([...t.messages,...e],!1),r([...a||[],...i||[]],!1)},onFinish:u,generateId:s})};function em({api:e="/api/chat",id:t,initialMessages:n,initialInput:r="",sendExtraMessageFields:i,experimental_onFunctionCall:o,onResponse:l,onFinish:s,onError:u,credentials:c,headers:d,body:f,generateId:p=ef}={}){let g=(0,a.useId)(),y=null!=t?t:g,h="string"==typeof e?[e,y]:y,[m]=(0,a.useState)([]),{data:w,mutate:v}=ee([h,"messages"],null,{fallbackData:null!=n?n:m}),{data:_=!1,mutate:E}=ee([h,"loading"],null),{data:b,mutate:R}=ee([h,"streamData"],null),{data:x,mutate:S}=ee([h,"error"],null),T=(0,a.useRef)(w||[]);(0,a.useEffect)(()=>{T.current=w||[]},[w]);let k=(0,a.useRef)(null),O=(0,a.useRef)({credentials:c,headers:d,body:f});(0,a.useEffect)(()=>{O.current={credentials:c,headers:d,body:f}},[c,d,f]);let C=(0,a.useCallback)(async t=>{try{E(!0),S(void 0);let n=new AbortController;k.current=n,await ey({getStreamedResponse:()=>eh(e,t,v,R,b,O,T,k,p,s,l,i),experimental_onFunctionCall:o,updateChatRequest:e=>{t=e},getCurrentMessages:()=>T.current}),k.current=null}catch(e){if("AbortError"===e.name)return k.current=null,null;u&&e instanceof Error&&u(e),S(e)}finally{E(!1)}},[v,E,e,O,l,s,u,S,R,b,i,o,T,k,p]),V=(0,a.useCallback)(async(e,{options:t,functions:n,function_call:r,data:a}={})=>(e.id||(e.id=p()),C({messages:T.current.concat(e),options:t,data:a,...void 0!==n&&{functions:n},...void 0!==r&&{function_call:r}})),[C,p]),D=(0,a.useCallback)(async({options:e,functions:t,function_call:n}={})=>0===T.current.length?null:"assistant"===T.current[T.current.length-1].role?C({messages:T.current.slice(0,-1),options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n}}):C({messages:T.current,options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n}}),[C]),A=(0,a.useCallback)(()=>{k.current&&(k.current.abort(),k.current=null)},[]),I=(0,a.useCallback)(e=>{v(e,!1),T.current=e},[v]),[L,N]=(0,a.useState)(r),j=(0,a.useCallback)((e,t={},n)=>{n&&(O.current={...O.current,...n}),e.preventDefault(),L&&(V({content:L,role:"user",createdAt:new Date},t),N(""))},[L,V]);return{messages:w||[],error:x,append:V,reload:D,stop:A,setMessages:I,input:L,setInput:N,handleInputChange:e=>{N(e.target.value)},handleSubmit:j,isLoading:_,data:b}}}}]);